<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Google Login</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0; padding: 10px; }
        #google-btn {
            background-color: #4285F4; color: white; border: none; padding: 12px;
            border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; font-size: 14px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        #google-btn:hover { background-color: #357ae8; }
        #status-msg { font-size: 12px; color: #666; margin-top: 10px; text-align: center; word-break: break-all; }
        /* 토큰을 보여줄 박스 스타일 추가 */
        #token-display {
            width: 90%;
            height: 60px;
            margin-top: 10px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            color: #333;
            font-size: 11px;
            word-break: break-all;
            display: none; /* 처음엔 숨김 */
            resize: none;
        }
    </style>
</head>
<body>
    <button id="google-btn">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" height="18">
        Google 계정으로 로그인
    </button>
    
    <p id="status-msg"></p>
    
    <textarea id="token-display" readonly onclick="this.select()"></textarea>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC_WCsf4OHyXHALFNAKQ-opiz-WTSCCQco",
            authDomain: "wsd-tp-7fd0a.firebaseapp.com",
            projectId: "wsd-tp-7fd0a",
            storageBucket: "wsd-tp-7fd0a.firebasestorage.app",
            messagingSenderId: "855478292990",
            appId: "1:855478292990:web:67294f995c7680bcdc30af",
            measurementId: "G-BXXGB1P3PB"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        document.getElementById('google-btn').addEventListener('click', () => {
            const btn = document.getElementById('google-btn');
            const status = document.getElementById('status-msg');
            const tokenBox = document.getElementById('token-display');
            
            btn.disabled = true;
            btn.innerText = "로그인 중...";

            signInWithPopup(auth, provider)
                .then((result) => {
                    return result.user.getIdToken();
                })
                .then((idToken) => {
                    // 1. 화면에 토큰 표시 (이제 눈으로 보입니다!)
                    tokenBox.style.display = "block";
                    tokenBox.value = idToken;
                    tokenBox.select(); // 편하게 전체 선택

                    // 2. 클립보드 복사 시도
                    navigator.clipboard.writeText(idToken)
                        .then(() => {
                            status.innerHTML = `<span style="color:green; font-weight:bold;">✅ 인증 성공!</span><br>토큰이 복사되었습니다.<br>아래 Streamlit 입력창에 붙여넣으세요 (Ctrl+V).`;
                        })
                        .catch(() => {
                            status.innerHTML = `<span style="color:green; font-weight:bold;">✅ 인증 성공!</span><br>아래 박스의 토큰을 복사하세요.`;
                        });
                    btn.innerText = "로그인 완료";
                })
                .catch((error) => {
                    console.error(error);
                    status.innerText = "❌ 실패: " + error.message;
                    status.style.color = "red";
                    btn.disabled = false;
                    btn.innerText = "Google 계정으로 로그인";
                });
        });
    </script>
</body>
</html>